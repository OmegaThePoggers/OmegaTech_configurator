---
phase: 6
plan: 1
wave: 1
depends_on: []
files_modified:
  - src/lib/storage.ts
  - src/app/build/page.tsx
  - src/app/configs/page.tsx
autonomous: true
must_haves:
  truths:
    - "User can save a PC build from the /build page"
    - "Saved builds persist across page refreshes via localStorage"
    - "Saved builds appear on the /configs page with component details and total price"
    - "User can delete a saved build from /configs"
  artifacts:
    - "src/lib/storage.ts exists with save/load/delete functions"
    - "src/app/configs/page.tsx renders saved builds from localStorage"
---

# Plan 6.1: Save & Load Builds (localStorage)

<objective>
Implement a localStorage-based persistence layer for PC builds. Users can save their current configuration from the /build page and view/delete saved builds on the /configs page.

Purpose: Delivers the "Simple backend" must-have using client-side persistence (Firebase-ready structure for future upgrade).
Output: A storage utility, a working Save button, and a populated /configs page.
</objective>

<context>
Load for context:
- src/app/build/page.tsx (Save Configuration button to wire)
- src/app/configs/page.tsx (empty state to replace with saved builds)
</context>

<tasks>

<task type="auto">
  <name>Create Storage Utility and Wire Save Button</name>
  <files>src/lib/storage.ts, src/app/build/page.tsx</files>
  <action>
    1. Create `src/lib/storage.ts` with the following functions:
       ```ts
       type SavedBuild = {
         id: string;
         name: string;
         components: Record<string, { name: string; price: number }>;
         totalPrice: number;
         savedAt: string; // ISO date string
       };

       function getBuilds(): SavedBuild[]
       function saveBuild(build: Omit<SavedBuild, 'id' | 'savedAt'>): SavedBuild
       function deleteBuild(id: string): void
       ```
       - `getBuilds`: reads from `localStorage.getItem('omega_builds')`, parses JSON, returns array.
       - `saveBuild`: generates ID via `Date.now().toString()`, adds `savedAt`, pushes to array, saves to localStorage, returns the new build.
       - `deleteBuild`: filters out by ID, saves back.

    2. Update `src/app/build/page.tsx`:
       - Import `saveBuild` from `@/lib/storage`.
       - Add `const [saved, setSaved] = useState(false)` state.
       - Find the existing "Add Build to Cart" button area. BELOW the existing grid of buttons, add a new full-width "Save Configuration" button.
       - On click: call `saveBuild({ name: 'Custom Build', components: selectedComponents as any, totalPrice: totalCost })`.
       - Show "Saved âœ“" feedback for 2 seconds (same pattern as Add Build to Cart).
       - Disable button when no components are selected.

    AVOID: Removing the existing "Add Build to Cart" button. The Save and Cart buttons are separate features.
  </action>
  <verify>grep "saveBuild" src/app/build/page.tsx</verify>
  <done>Clicking "Save Configuration" on /build stores the build in localStorage. Refreshing the page and checking localStorage shows the saved data.</done>
</task>

<task type="auto">
  <name>Populate Configs Page with Saved Builds</name>
  <files>src/app/configs/page.tsx</files>
  <action>
    1. Convert to 'use client' component (needs localStorage access).
    2. Remove the metadata export (layout.tsx already has site metadata).
    3. Import `getBuilds`, `deleteBuild` from `@/lib/storage`.
    4. On mount, load builds via `useEffect` + `useState`.
    5. Display saved builds in a card grid:
       - Each card shows: build name, date saved, component list, total price, and a "Delete" button.
       - Date formatted as relative (e.g., "2 hours ago") or simple date string.
    6. Keep the empty state when no builds are saved.
    7. When deleting, call `deleteBuild(id)` and update the local state.

    AVOID: Using `getServerSideProps` or server-side data fetching. This is purely client-side localStorage.
  </action>
  <verify>grep "getBuilds" src/app/configs/page.tsx</verify>
  <done>The /configs page shows all saved builds with name, date, components, and total. Delete button removes a build and updates the display.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Save button on /build stores build in localStorage
- [ ] /configs page displays saved builds
- [ ] Delete button on /configs removes a build
- [ ] Builds persist across page refresh
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
