---
phase: 4
plan: 2
wave: 2
depends_on: ["4.1"]
files_modified:
  - src/context/CartContext.tsx
  - src/app/cart/page.tsx
  - src/app/layout.tsx
  - src/components/layout/navbar.tsx
  - src/app/components/page.tsx
autonomous: true
must_haves:
  truths:
    - "User can add a component to the cart from the Browse page"
    - "User can view all cart items on a dedicated /cart page"
    - "User can remove items from the cart"
    - "Cart shows item count badge in the Navbar"
    - "Cart calculates and displays the total price"
  artifacts:
    - "src/context/CartContext.tsx exists with add/remove/clear functions"
    - "src/app/cart/page.tsx exists and renders cart contents"
---

# Plan 4.2: Shopping Cart System

<objective>
Implement a global shopping cart using React Context. Users can add components from the Browse page, view them on a /cart page, remove items, and see a live total.

Purpose: Demonstrates a classic e-commerce shopping cart and state management pattern for the project deliverables.
Output: A CartContext provider, a /cart page, and integration with the Browse Components page.
</objective>

<context>
Load for context:
- src/data/pc-components.json
- src/app/components/page.tsx (from Plan 4.1)
- src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Create Cart Context Provider</name>
  <files>src/context/CartContext.tsx, src/app/layout.tsx</files>
  <action>
    1. Create `src/context/CartContext.tsx` as a 'use client' module.
    2. Define a CartItem type: `{ name: string; price: number; category: string; quantity: number }`.
    3. Create a CartContext with the following state and functions:
       - `items: CartItem[]`
       - `addItem(item)` — adds item or increments quantity if already in cart
       - `removeItem(name)` — removes item entirely
       - `clearCart()` — empties the cart
       - `totalItems` — computed count of all items (sum of quantities)
       - `totalPrice` — computed sum of all item prices * quantities
    4. Wrap the app in `<CartProvider>` inside `src/app/layout.tsx`.
       - Create a new client wrapper component if needed to avoid making layout.tsx a client component (e.g., `src/components/providers.tsx` wrapping children with `<CartProvider>`).
    
    AVOID: Making `layout.tsx` a client component — keep it as a server component. Instead, create a `Providers` wrapper component that is 'use client' and wraps children.
  </action>
  <verify>npm run build</verify>
  <done>CartContext is available app-wide. Layout remains a server component. Cart state is managed via React Context.</done>
</task>

<task type="auto">
  <name>Build Cart Page and Wire Up Navbar Badge</name>
  <files>src/app/cart/page.tsx, src/components/layout/navbar.tsx, src/app/components/page.tsx</files>
  <action>
    1. Create `src/app/cart/page.tsx` as a 'use client' page:
       - Display cart items in a list/table format (name, category, price, quantity, remove button).
       - Show total price at the bottom.
       - Include a "Clear Cart" button.
       - Show empty state if cart is empty ("Your cart is empty").
    
    2. Update `src/components/layout/navbar.tsx`:
       - Make it a 'use client' component (to access CartContext).
       - Add a Cart icon (ShoppingCart from lucide-react) next to the "Start Building" button.
       - Display a small badge with `totalItems` count when > 0.
       - Link the icon to `/cart`.
    
    3. Update `src/app/components/page.tsx`:
       - Import `useCart` from CartContext.
       - Wire the "Add to Cart" button on each component card to call `addItem()`.
       - Show visual feedback when item is added (e.g., button text changes to "Added ✓" briefly, or "In Cart" if already added).
    
    AVOID: Using `alert()` for feedback. Use inline state changes on the button instead.
  </action>
  <verify>npm run build</verify>
  <done>User can click "Add to Cart" on Browse page → badge updates in Navbar → /cart shows the item with correct price → "Remove" removes it.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Adding an item from /components updates Navbar badge count
- [ ] /cart page displays added items with name, price, category
- [ ] Remove button on /cart page removes the item
- [ ] Clear Cart empties everything
- [ ] Total price is calculated correctly
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
