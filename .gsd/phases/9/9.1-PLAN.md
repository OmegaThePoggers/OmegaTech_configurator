---
phase: 9
plan: 1
wave: 1
depends_on: []
files_modified:
  - src/app/cart/page.tsx
  - src/app/checkout/page.tsx
  - src/context/CartContext.tsx
autonomous: true
must_haves:
  truths:
    - "Cart page has a 'Proceed to Checkout' button"
    - "Checkout page exists at /checkout"
    - "Checkout shows every component from cart builds with per-store purchase links"
    - "Each component row shows store buttons (Amazon, Flipkart, MD Computers) linking to real URLs"
    - "Grand total is displayed at the bottom"
    - "CartContext exposes a method to get all unique components with their purchaseLinks"
  artifacts:
    - "src/app/checkout/page.tsx is a functional checkout page"
    - "src/app/cart/page.tsx has Proceed to Checkout button"
---

# Plan 9.1: Price Comparison Checkout Page

<objective>
Create a checkout page at /checkout that displays all cart components in a price comparison table. Each component shows its name, category, price, and clickable buttons for each store (Amazon, Flipkart, MD Computers) that link to the actual product page.

Purpose: Let users buy individual components from their preferred retailer.
Output: A /checkout page with per-component store links.
</objective>

<context>
Load for context:
- src/app/cart/page.tsx (current cart)
- src/context/CartContext.tsx (cart state)
- src/data/pc-components.json (purchaseLinks structure)
</context>

<tasks>

<task type="auto">
  <name>Update CartContext to expose purchaseLinks</name>
  <files>src/context/CartContext.tsx</files>
  <action>
    The current CartBuild stores components as `{ name, price, category }` but NOT purchaseLinks. Two approaches:

    **Chosen approach:** Create a utility function `getCheckoutItems()` that:
    1. Collects all unique component names from builds + individual items
    2. Looks up each component in `pc-components.json` to retrieve its `purchaseLinks`
    3. Returns an array of `{ name, category, price, purchaseLinks }` objects

    This should be a standalone utility in `src/lib/checkout.ts` (NOT in CartContext) to keep context lean.

    ```ts
    // src/lib/checkout.ts
    import pcComponentsData from '@/data/pc-components.json';

    type CheckoutItem = {
      name: string;
      category: string;
      price: number;
      purchaseLinks: { store: string; url: string }[];
    };

    export function getCheckoutItems(
      builds: CartBuild[],
      items: CartItem[]
    ): CheckoutItem[] {
      // Collect all component names from builds
      // Collect all component names from individual items
      // Deduplicate by name
      // Look up purchaseLinks from pcComponentsData
      // Return enriched items
    }
    ```

    AVOID: Modifying CartContext itself — keep it lean.
  </action>
  <verify>npm run build</verify>
  <done>src/lib/checkout.ts exports getCheckoutItems that resolves purchaseLinks for cart items.</done>
</task>

<task type="auto">
  <name>Create Checkout Page and Add Button to Cart</name>
  <files>src/app/checkout/page.tsx, src/app/cart/page.tsx</files>
  <action>
    1. **Create `/checkout` page** (`src/app/checkout/page.tsx`):
       - 'use client' directive
       - Import `useCart` and `getCheckoutItems`
       - Call `getCheckoutItems(builds, items)` to get enriched items
       - Render a table/card layout:
         ```
         ┌──────────────────────────────────────────────────┐
         │ Price Comparison Checkout                         │
         ├──────────────────────────────────────────────────┤
         │ CPU: Intel Core i5-13600K            ₹24,858     │
         │ [Amazon] [Flipkart] [MD Computers]               │
         ├──────────────────────────────────────────────────┤
         │ GPU: NVIDIA RTX 4060 Ti              ₹35,512     │
         │ [Amazon] [Flipkart] [MD Computers]               │
         ├──────────────────────────────────────────────────┤
         │ ...                                              │
         ├──────────────────────────────────────────────────┤
         │ Grand Total                          ₹1,20,370   │
         └──────────────────────────────────────────────────┘
         ```
       - Each store button should be an `<a>` tag opening in a new tab (`target="_blank"`)
       - Style store buttons with distinct colors:
         - Amazon → orange (`bg-amber-600`)
         - Flipkart → blue (`bg-blue-600`)
         - MD Computers → green (`bg-emerald-600`)
       - Show a "Back to Cart" link
       - Show empty state if cart is empty

    2. **Add "Proceed to Checkout" button** to cart page:
       - Below the Total card, add a full-width button linking to `/checkout`
       - Style: prominent, white bg, dark text
       - Use Next.js `Link` component

    AVOID: Any actual payment processing — this is a price comparison tool only.
    AVOID: Changing existing cart display structure.
  </action>
  <verify>npm run build</verify>
  <done>Cart has a "Proceed to Checkout" button. /checkout page shows components with per-store buy links.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] /checkout page exists and renders
- [ ] Each component shows Amazon, Flipkart, MD Computers buttons
- [ ] Store buttons link to correct URLs from pc-components.json
- [ ] Grand total matches cart total
- [ ] Cart page has checkout button
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
