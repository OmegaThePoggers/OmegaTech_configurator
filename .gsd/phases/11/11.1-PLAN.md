---
phase: 11
plan: 1
wave: 1
depends_on: []
files_modified:
  - vercel.json
  - package.json
autonomous: true
must_haves:
  truths:
    - "vercel.json exists with correct production routing/headers"
    - "Build script runs TypeScript type checking and linting before Next.js build"
    - "Production build passes without errors"
  artifacts:
    - "vercel.json is configured for Next.js App Router"
---

# Plan 11.1: Vercel Production Build Setup

<objective>
Prepare the application for production deployment on Vercel. This includes adding strict build checks, configuring Vercel routing/headers, and ensuring the application compiles cleanly.

Purpose: Guarantee a stable, high-performance production build.
Output: A `vercel.json` file, updated `build` script, and a passing production build.
</objective>

<context>
Load for context:
- package.json
</context>

<tasks>

<task type="auto">
  <name>Configure Strict Build Script and Vercel Config</name>
  <files>package.json, vercel.json</files>
  <action>
    1. **Update `package.json` build script**:
       Change the `build` script to ensure TypeScript and ESLint pass before building:
       ```json
       "scripts": {
         "build": "tsc --noEmit && eslint src/ --max-warnings=0 && next build",
         // ...
       }
       ```
       *(If ESLint is not configured, just use `tsc --noEmit && next build`)*

    2. **Create `vercel.json`**:
       Add standard security headers and caching rules for Next.js:
       ```json
       {
         "headers": [
           {
             "source": "/(.*)",
             "headers": [
               { "key": "X-Frame-Options", "value": "DENY" },
               { "key": "X-Content-Type-Options", "value": "nosniff" },
               { "key": "Referrer-Policy", "value": "strict-origin-when-cross-origin" }
             ]
           },
           {
             "source": "/images/(.*)",
             "headers": [
               { "key": "Cache-Control", "value": "public, max-age=31536000, immutable" }
             ]
           }
         ]
       }
       ```

    AVOID: Complex serverless function routing (Next.js App router handles this automatically).
  </action>
  <verify>npm run build</verify>
  <done>package.json updated, vercel.json created, and build passes cleanly.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] `npm run build` succeeds (meaning TS types are correct)
- [ ] `vercel.json` exists in root
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
