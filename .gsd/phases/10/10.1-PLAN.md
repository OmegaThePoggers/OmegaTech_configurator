---
phase: 10
plan: 1
wave: 1
depends_on: []
files_modified:
  - .env.local
  - src/app/api/create-order/route.ts
  - src/app/api/verify-payment/route.ts
autonomous: true
must_haves:
  truths:
    - "Razorpay SDK is installed (razorpay npm package)"
    - ".env.example exists with RAZORPAY_KEY_ID and RAZORPAY_KEY_SECRET"
    - "POST /api/create-order creates a Razorpay order and returns order ID"
    - "POST /api/verify-payment verifies payment signature"
  artifacts:
    - "src/app/api/create-order/route.ts is functional"
    - "src/app/api/verify-payment/route.ts is functional"
---

# Plan 10.1: Razorpay Backend (API Routes)

<objective>
Install Razorpay SDK, create .env.example with test key placeholders, and build two Next.js API routes:
1. `/api/create-order` — creates a Razorpay order with the cart total
2. `/api/verify-payment` — verifies the payment signature after checkout

Purpose: Backend infrastructure for Razorpay payment flow.
</objective>

<context>
- src/app/checkout/page.tsx
- src/context/CartContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Install Razorpay and Create Env Template</name>
  <files>.env.local, .env.example</files>
  <action>
    1. `npm install razorpay`
    2. Create `.env.example`:
       ```
       RAZORPAY_KEY_ID=rzp_test_xxxxxxxxxxxx
       RAZORPAY_KEY_SECRET=xxxxxxxxxxxxxxxxxxxxxxxx
       NEXT_PUBLIC_RAZORPAY_KEY_ID=rzp_test_xxxxxxxxxxxx
       ```
    3. Create `.env.local` with same placeholders.
    4. Verify `.env.local` is in `.gitignore`.
  </action>
  <verify>node -e "require('razorpay')"</verify>
  <done>razorpay installed, .env.example committed.</done>
</task>

<task type="auto">
  <name>Create Order and Verify Payment API Routes</name>
  <files>src/app/api/create-order/route.ts, src/app/api/verify-payment/route.ts</files>
  <action>
    1. `/api/create-order`: Create Razorpay order (amount in paise), return order ID.
    2. `/api/verify-payment`: HMAC SHA256 signature verification, return verified status.
  </action>
  <verify>npm run build</verify>
  <done>Both API routes build successfully.</done>
</task>

</tasks>

<success_criteria>
- [ ] razorpay in node_modules
- [ ] .env.example exists
- [ ] Both routes compile
</success_criteria>
