---
phase: 7
plan: 2
wave: 2
depends_on: ["7.1"]
files_modified:
  - src/app/build/page.tsx
autonomous: true
must_haves:
  truths:
    - "Compatibility checker uses spec data instead of string matching"
    - "Socket compatibility is checked (CPU socket vs motherboard — warn if mismatch)"
    - "DDR generation is checked (CPU supported DDR vs RAM DDR)"
    - "PSU wattage is checked against GPU recommendedPsu field"
    - "Case GPU length is checked against GPU length"
    - "Warnings are specific and helpful"
  artifacts:
    - "src/app/build/page.tsx has spec-based compatibility logic"
---

# Plan 7.2: Enhanced Compatibility Engine

<objective>
Rewrite the compatibility checker in the /build page to use the new spec fields from pc-components.json instead of hardcoded string matching. This makes checks accurate, extensible, and data-driven.

Purpose: Replace fragile string-matching with proper spec-field comparison.
Output: Accurate compatibility warnings on the /build page.
</objective>

<context>
Load for context:
- src/data/pc-components.json (enriched with specs from Plan 7.1)
- src/app/build/page.tsx (current compatibility logic — lines 56-83)
</context>

<tasks>

<task type="auto">
  <name>Rewrite Compatibility Checker with Spec Data</name>
  <files>src/app/build/page.tsx</files>
  <action>
    1. Update the `ComponentItem` type to include the new spec fields:
       ```ts
       type ComponentItem = {
         name: string;
         price: number;
         purchaseLinks: ComponentStoreLink[];
         // Spec fields (optional since different categories have different specs)
         socket?: string;
         ddrGeneration?: string;
         tdp?: number;
         cores?: number;
         brand?: string;
         recommendedPsu?: number;
         length?: number;
         speed?: number;
         capacity?: number | string;
         modules?: number;
         type?: string;
         interface?: string;
         wattage?: number;
         rating?: string;
         modular?: boolean;
         formFactor?: string;
         maxGpuLength?: number;
         fans?: number;
       };
       ```

    2. Replace the `compatibilityWarnings` useMemo with spec-based checks:

       **Check 1: DDR Generation**
       If CPU has `ddrGeneration` and RAM has `ddrGeneration`:
       - If CPU ddrGeneration is "DDR5" AND RAM ddrGeneration is "DDR4" → warning
       - If CPU ddrGeneration is "DDR4/DDR5" → both are fine

       **Check 2: PSU Wattage for GPU**
       If GPU has `recommendedPsu` and PSU has `wattage`:
       - If PSU wattage < GPU recommendedPsu → warning with specific numbers

       **Check 3: GPU Length vs Case**
       If GPU has `length` and Case has `maxGpuLength`:
       - If GPU length > Case maxGpuLength → warning ("GPU too long for this case")

       **Check 4: Total TDP vs PSU**
       Sum CPU.tdp + GPU.tdp. If total > PSU.wattage * 0.8 → warning ("System TDP approaching PSU limit")

    3. Make warning messages specific with actual values, e.g.:
       - "RAM is DDR4 but CPU requires DDR5"
       - "GPU recommends 750W PSU, but selected PSU is only 650W"
       - "GPU is 304mm but case only supports up to 280mm"

    AVOID: Removing the performance score — keep that as-is.
    AVOID: Breaking the existing build flow — only change compatibilityWarnings logic.
  </action>
  <verify>npm run build</verify>
  <done>Compatibility checker uses spec fields (ddrGeneration, recommendedPsu, wattage, length, maxGpuLength, tdp) instead of string matching. Warnings show actual values.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] DDR mismatch warning appears when pairing DDR4 RAM with a DDR5-only CPU
- [ ] PSU warning appears when GPU needs more wattage than PSU provides
- [ ] Case length warning appears when GPU is too long
- [ ] No false warnings for compatible combinations
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
