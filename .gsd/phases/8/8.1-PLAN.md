---
phase: 8
plan: 1
wave: 1
depends_on: []
files_modified:
  - src/components/viewer/PCViewer.tsx
autonomous: true
must_haves:
  truths:
    - "PCViewer accepts a `selectedComponents` prop"
    - "Each internal component (CPU, GPU, RAM, PSU, Case, Storage) shows/hides based on whether it is selected"
    - "Unselected components render as ghosted wireframes (very low opacity)"
    - "Selected components use brand-specific colors: NVIDIA=green, AMD=red, Intel=blue, default=cyan"
    - "GPU mesh scales its X-dimension based on the `length` spec field"
    - "PSU mesh scales based on `wattage` spec field"
    - "RAM renders 1 or 2 sticks based on the `modules` field"
  artifacts:
    - "src/components/viewer/PCViewer.tsx accepts props and renders reactively"
---

# Plan 8.1: Reactive PCViewer Component

<objective>
Make PCViewer reactive to selected components. Each internal 3D part should visually respond to what the user has selected in the configurator — changing color by brand, scaling by spec, and ghosting unselected parts.

Purpose: Give the user real-time visual feedback of their PC build taking shape.
Output: A PCViewer component that accepts `selectedComponents` and renders accordingly.
</objective>

<context>
Load for context:
- src/components/viewer/PCViewer.tsx (current static viewer)
- src/data/pc-components.json (spec fields for color/scale logic)
</context>

<tasks>

<task type="auto">
  <name>Add Props and Reactive Rendering to PCViewer</name>
  <files>src/components/viewer/PCViewer.tsx</files>
  <action>
    1. Define a `SelectedPart` type and `PCViewerProps`:
       ```ts
       type SelectedPart = {
         name: string;
         brand?: string;
         tdp?: number;
         length?: number;
         wattage?: number;
         modules?: number;
         ddrGeneration?: string;
       } | undefined;

       type PCViewerProps = {
         className?: string;
         selectedComponents?: {
           CPU?: SelectedPart;
           GPU?: SelectedPart;
           RAM?: SelectedPart;
           Storage?: SelectedPart;
           PSU?: SelectedPart;
           Case?: SelectedPart;
         };
       };
       ```

    2. Update each sub-component (CPU, GPU, RAM, PSU) to accept an `active` boolean and optional spec props:
       - **When active=true**: Render solid mesh with brand-specific color:
         - Brand "NVIDIA" → `0x76b900` (NVIDIA green)
         - Brand "AMD" → `0xed1c24` (AMD red)
         - Brand "Intel" → `0x0071c5` (Intel blue)
         - Default → `0x00ffff` (cyan)
       - **When active=false**: Render with very low opacity (0.08) and use wireframe edges only — creating a "ghost" placeholder effect.

    3. Make GPU mesh scale dynamically:
       - Base length is 1.2 units for a 240mm card
       - Scale X proportionally: `length / 240 * 1.2`
       - Clamp between 1.0 and 1.8 to prevent visual issues

    4. Make RAM render the correct number of sticks:
       - If `modules === 1`, render 1 stick
       - If `modules === 2` (or default), render 2 sticks

    5. Make PSU mesh scale based on wattage:
       - Base size is for 650W
       - Scale Y proportionally: `wattage / 650 * 0.8`
       - Clamp between 0.6 and 1.2

    6. Pass `selectedComponents` from `PCViewer` → `Scene` → individual components.

    7. Case (PCCase) should ALWAYS render as the wireframe shell (no ghosting for the case — it's always visible). But if a Case is selected, change the edge color to match brand color (e.g., NZXT could be white).

    AVOID: Changing the Canvas setup, camera position, or OrbitControls config.
    AVOID: Adding any new npm dependencies — only use existing three/fiber/drei.
  </action>
  <verify>npm run build</verify>
  <done>PCViewer renders reactively: ghosted parts when unselected, brand-colored solid parts when selected, with dynamic scaling for GPU length and PSU wattage.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] PCViewer builds without errors
- [ ] Component accepts `selectedComponents` prop
- [ ] Default rendering (no props) shows all parts as ghosted wireframes
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
